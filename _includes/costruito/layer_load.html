<script>
//Load of GeoJSON data
var geojson;
function addSource() {
	map.addSource('vitivinicoli_aree', {
		'type': 'geojson',
		'data': '/../assets/json/areas.geojson'
	});
	map.addSource('infernot', {
		'type': 'geojson',
		'data': '/../assets/json/infernot.geojson'
	});
	// Mapbox default DEM source
	map.addSource('mapbox-dem', {
		'type': 'raster-dem',
		'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
		'tileSize': 256,
		'maxzoom': 14
	});
} //END of addSource

// List of added layers; rendering and symbology of GeoJSON data.
function addLayer() {
	map.addLayer({
		'id': 'fill_area',
		'type': 'fill',
		'source': 'vitivinicoli_aree', // reference the data source
		'layout': {
			// Make the layer visible by default.
			'visibility': 'visible'
		},
		'paint': {
			'fill-color': [
				'match',
				['get', 'TIPO'],
				'Buffer zone',
				'#feebe2',
				'Core zone',
				'#f768a1',
				'#ccc'
			],
			//'fill-color': '#0080ff', // blue color fill
			'fill-opacity': 0.3
		}
	});
	// Add a black outline around the polygon.
	map.addLayer({
		'id': 'outline_area',
		'type': 'line',
		'source': 'vitivinicoli_aree',
		'layout': {
			// Make the layer visible by default.
			'visibility': 'visible'
		},
		'paint': {
			'line-color': '#000',
			'line-width': 1
		}
	});
	map.addLayer({
		'id': 'infernot',
		'type': 'symbol',
		'layout': {
			// Make the layer visible by default.
			'icon-image': 'infernot-marker',
			'visibility': 'visible'
			/*'text-field': [
			'format',
			['get', 'Denominaz'],
			{ 'font-scale': 0.8 },
			'\n',
			{},
		],
		'text-font': [
		'Open Sans Semibold',
		'Arial Unicode MS Bold'],
		'text-offset': [0, 1.25],
		'text-anchor': 'top'*/
	},
	'source': 'infernot',
	// 'paint': {
	// make circles larger as the user zooms from z12 to z22
	// 'circle-radius': {
	// 'base': 3.5,
	// 'stops': [
	// [12, 2],
	// [22, 180]
	// ]
	// },
	// https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-match
	// 'circle-color': [
	// 'match',
	// ['get', 'Provincia'],
	// 'AL',
	// '#fbb03b',
	// 'AT',
	// '#223b53',
	// other '#ccc']
	// }
	});
map.addLayer({
	'id': 'sky',
	'type': 'sky',
	'paint': {
		'sky-type': 'atmosphere',
		'sky-atmosphere-sun': [0.0, 0.0],
		'sky-atmosphere-sun-intensity': 15
	}
});
// 3D properties
map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.2 });
// END of 3D properties
}
//END of addLayer

// Markers load and render
function addMarkers () {
	map.on('load', function () {
		// Add an image to use as a custom marker
		map.loadImage(
			'/../assets/markers/infernot-marker.png',
			function (error, image) {
				if (error) throw error;
				map.addImage('infernot-marker', image);
			}
		);
	});
	// loadImage is async -> images are not rendered when style changes, hence custom markers.
	// Still has problems with certain zooms
	map.on('styleimagemissing', function (e) {
		map.loadImage(fallbackImageUrl, function(err, data) {
			if (!err) {
				if (!map.hasImage(e.id)) {
					map.addImage(e.id, data);
				}
			}
		});
	});
}
// Fallback for sprites / markers not loading when changing styles

// END of Markers load and render
</script>
